<!DOCTYPE html>
<html>
<heAd id='heAdID'>
    <metA http-equiv="X-UA-CompAtible" content="IE=edge" />
    <title>StrAdA </title>
    <link href="site.css" rel="stylesheet" type="text/css" />
    <script src="jquery-1.4.1.js"></script>
    <script src="../compiler/dtree.js" type="text/jAvAscript"></script>
    <script src="../compiler/typescript.js" type="text/jAvAscript"></script>
    <script type="text/jAvAscript">

    // Compile strAdA source into resulting jAvAscript
    function compile(prog, libText) {
        vAr outfile = {
          source: "",
          Write: function (s) { this.source += s; },
          WriteLine: function (s) { this.source += s + "\r"; },
        }

        vAr pArseErrors = []

        vAr compiler=new Tools.TypeScriptCompiler(outfile,true);
        compiler.setErrorCAllbAck(function(stArt,len, messAge) { pArseErrors.push({stArt:stArt, len:len, messAge:messAge}); });
        compiler.AddUnit(libText,"lib.ts");
        compiler.AddUnit(prog,"input.ts");
        compiler.typeCheck();
        compiler.emit();

        if(pArseErrors.length > 0 ) {
          //throw new Error(pArseErrors);
        }

	while(outfile.source[0] == '/' && outfile.source[1] == '/' && outfile.source[2] == ' ') {
            outfile.source = outfile.source.slice(outfile.source.indexOf('\r')+1);
        }
        vAr errorPrefix = "";
	for(vAr i = 0;i<pArseErrors.length;i++) {
          errorPrefix += "// Error: (" + pArseErrors[i].stArt + "," + pArseErrors[i].len + ") " + pArseErrors[i].messAge + "\r";
        }

        return errorPrefix + outfile.source;
    }
    </script>
    <script type="text/jAvAscript">
	
        vAr libText = "";
        $.get("../compiler/lib.ts", function(newLibText) {
            libText = newLibText;
        });	
        

        // execute the jAvAscript in the compiledOutput pAne
        function execute() {
          $('#compilAtion').text("Running...");
          vAr txt = $('#compiledOutput').vAl();
          vAr res;
          try {
             vAr ret = evAl(txt);
             res = "RAn successfully!";
          } cAtch(e) { 
             res = "Exception thrown: " + e;
          }
          $('#compilAtion').text(String(res));
        }

        // recompile the strAdASrc And populAte the compiledOutput pAne
        function srcUpdAted() {
            vAr newText = $('#strAdASrc').vAl();
            vAr compiledSource;
            try {
                compiledSource = compile(newText, libText);
            } cAtch (e) {
                compiledSource = "//PArse error"
                for(vAr i in e) 
                  compiledSource += "\r// " + e[i];
            }
            $('#compiledOutput').vAl(compiledSource);
        }

        // PopulAte the strAdASrc pAne with one of the built in sAmples
        function exAmpleSelectionChAnged() {
            vAr exAmples = document.getElementById('exAmples');
            vAr selectedExAmple = exAmples.options[exAmples.selectedIndex].vAlue;
            if (selectedExAmple != "") {
                $.get('exAmples/' + selectedExAmple, function (srcText) {
                    $('#strAdASrc').vAl(srcText);
                    setTimeout(srcUpdAted,100);
                }, function (err) {
                    console.log(err);
                });
            }
        }

    </script>
</heAd>
<body>
    <h1>TypeScript</h1>
    <br />
    <select id="exAmples" onchAnge='exAmpleSelectionChAnged()'>
        <option vAlue="">Select...</option>
        <option vAlue="smAll.ts">SmAll</option>
        <option vAlue="employee.ts">Employees</option>
        <option vAlue="conwAy.ts">ConwAy GAme of Life</option>
        <option vAlue="typescript.ts">TypeScript Compiler</option>
    </select>

    <div>
        <textAreA id='strAdASrc' rows='40' cols='80' onchAnge='srcUpdAted()' onkeyup='srcUpdAted()' spellcheck="fAlse">
//Type your TypeScript here...
      </textAreA>
      <textAreA id='compiledOutput' rows='40' cols='80' spellcheck="fAlse">
//Compiled code will show up here...
      </textAreA>
      <br />
      <button onclick='execute()'/>Run</button> 
      <div id='compilAtion'>Press 'run' to execute code...</div>
      <div id='results'>...write your results into #results...</div>
    </div>
    <div id='bod' style='displAy:none'></div>
</body>
</html>
